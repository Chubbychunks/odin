## This file was automatically generated by odin.
## Do not edit by hand as changes will be lost.
.R6_main_model <- R6::R6Class(
  "odin_model",
  parent_env = environment(odin::odin),
  public = list(
    name = "main_model",
    ptr = NULL,
    use_dde = NULL,
    ## Cache:
    init = NULL,
    variable_order = NULL,
    output_order = NULL,
    output_length = NULL,
    names = NULL,
    transform_variables = NULL,
    interpolate_t = NULL,
    ## Methods:
    initialize = function(user = NULL, use_dde = FALSE) {
      self$ptr <- .Call("main_model_create", user, use_dde, PACKAGE = "taspprepodin")
      self$use_dde <- use_dde
      self$init <- .Call("main_model_initialise", self$ptr, NA_real_, PACKAGE = "taspprepodin")
      if (use_dde) {
        loadNamespace("dde")
      }
      self$update_cache()
    },

    set_user = function(..., user = list(...)) {
      .Call("r_main_model_set_user", self$ptr, user, PACKAGE = "taspprepodin")
      self$init <- .Call("main_model_initialise", self$ptr, NA_real_, PACKAGE = "taspprepodin")
      self$update_cache()
      invisible(self$init)
    },

    update_cache = function() {
      self$variable_order <- .Call("main_model_variable_order", self$ptr, PACKAGE = "taspprepodin")
      self$output_order <- .Call("main_model_output_order", self$ptr, PACKAGE = "taspprepodin")
          self$interpolate_t <- .Call("main_model_interpolate_t", self$ptr, PACKAGE = "taspprepodin")
      odin_prepare(self, FALSE)
    },

    deriv = function(t, y) {
      .Call("main_model_deriv_r", self$ptr, t, y, PACKAGE = "taspprepodin")
    },

    initial = function(t) {
      self$init
    },

    run = function(t, y = NULL, ..., tcrit = NULL, use_names = TRUE) {
      if (is.null(y)) {
        y <- self$init
      }
      r <- self$interpolate_t
      if (t[[1L]] < r[[1L]]) {
        stop("Integration times do not span interpolation range; min: ",
              r[[1L]])
      }
      if (!is.na(r[[2L]]) && t[[length(t)]] > r[[2L]]) {
        stop("Integration times do not span interpolation range; max: ",
              r[[2L]])
      }
      if (is.null(tcrit) && !is.na(r[[2L]]) && !self$use_dde) {
        tcrit <- r[[2L]]
      }
      if (self$use_dde) {
        ret <- dde::dopri(y, t, "main_model_deriv_dde", self$ptr,
                          dllname="taspprepodin",
                          n_out=self$output_length, output="main_model_output_dde",
                          parms_are_real=FALSE,
                          by_column=TRUE, return_initial=TRUE,
                          return_time=TRUE, return_output_with_y=TRUE, ...)
      } else {
        ret <- deSolve::ode(y, t, "main_model_deriv_ds", self$ptr,
                            initfunc = "main_model_initmod_ds", dllname = "taspprepodin",
                            nout = self$output_length,
                            tcrit = tcrit,
                            ...)
      }
      if (use_names) {
        colnames(ret) <- self$names
      } else {
        colnames(ret) <- NULL
      }
      ret
    },

    contents = function() {
      .Call("main_model_contents", self$ptr, PACKAGE = "taspprepodin")
    }
  ))
main_model <- function(Ncat, Nage, infect_ART, infect_acute, R, dur_FSW, rate_leave_FSW, zetaa_t, zetab_t, zetac_t, zetaa_y, zetab_y, zetac_y, epsilon_t_comm, epsilon_y_comm, fc_t_comm, fc_y_comm, fP_t_comm, fP_y_comm, fc_t_noncomm, fc_y_noncomm, fP_t_noncomm, fP_y_noncomm, omega, mu, gamma01, gamma02, gamma03, gamma04, gamma11, gamma22, gamma23, gamma24, gamma32, gamma33, gamma34, gamma42, gamma43, gamma44, rho2, rho3, rho4, rho5, phi2, phi3, phi4, phi5, psia, psib, tau01, tau11, tau2, tau3, tau4, tau5, kappaa, kappab, kappac, alpha01, alpha02, alpha03, alpha04, alpha05, alpha11, alpha21, alpha22, alpha23, alpha24, alpha25, alpha32, alpha33, alpha34, alpha35, alpha42, alpha43, alpha44, alpha45, beta, c_comm, c_noncomm, ec, eP, eP0, eP1a, eP1b, eP1c, eP1d, n_comm, n_noncomm, S0_init, S1a_init, S1b_init, S1c_init, S1d_init, I01_init, I11_init, I02_init, I03_init, I04_init, I05_init, I22_init, I23_init, I24_init, I25_init, I32_init, I33_init, I34_init, I35_init, I42_init, I43_init, I44_init, I45_init, cumuInf_init, theta, OnPrEP_init, M_comm, M_noncomm, user = list(Ncat = Ncat, Nage = Nage, infect_ART = infect_ART, infect_acute = infect_acute, R = R, dur_FSW = dur_FSW, rate_leave_FSW = rate_leave_FSW, zetaa_t = zetaa_t, zetab_t = zetab_t, zetac_t = zetac_t, zetaa_y = zetaa_y, zetab_y = zetab_y, zetac_y = zetac_y, epsilon_t_comm = epsilon_t_comm, epsilon_y_comm = epsilon_y_comm, fc_t_comm = fc_t_comm, fc_y_comm = fc_y_comm, fP_t_comm = fP_t_comm, fP_y_comm = fP_y_comm, fc_t_noncomm = fc_t_noncomm, fc_y_noncomm = fc_y_noncomm, fP_t_noncomm = fP_t_noncomm, fP_y_noncomm = fP_y_noncomm, omega = omega, mu = mu, gamma01 = gamma01, gamma02 = gamma02, gamma03 = gamma03, gamma04 = gamma04, gamma11 = gamma11, gamma22 = gamma22, gamma23 = gamma23, gamma24 = gamma24, gamma32 = gamma32, gamma33 = gamma33, gamma34 = gamma34, gamma42 = gamma42, gamma43 = gamma43, gamma44 = gamma44, rho2 = rho2, rho3 = rho3, rho4 = rho4, rho5 = rho5, phi2 = phi2, phi3 = phi3, phi4 = phi4, phi5 = phi5, psia = psia, psib = psib, tau01 = tau01, tau11 = tau11, tau2 = tau2, tau3 = tau3, tau4 = tau4, tau5 = tau5, kappaa = kappaa, kappab = kappab, kappac = kappac, alpha01 = alpha01, alpha02 = alpha02, alpha03 = alpha03, alpha04 = alpha04, alpha05 = alpha05, alpha11 = alpha11, alpha21 = alpha21, alpha22 = alpha22, alpha23 = alpha23, alpha24 = alpha24, alpha25 = alpha25, alpha32 = alpha32, alpha33 = alpha33, alpha34 = alpha34, alpha35 = alpha35, alpha42 = alpha42, alpha43 = alpha43, alpha44 = alpha44, alpha45 = alpha45, beta = beta, c_comm = c_comm, c_noncomm = c_noncomm, ec = ec, eP = eP, eP0 = eP0, eP1a = eP1a, eP1b = eP1b, eP1c = eP1c, eP1d = eP1d, n_comm = n_comm, n_noncomm = n_noncomm, S0_init = S0_init, S1a_init = S1a_init, S1b_init = S1b_init, S1c_init = S1c_init, S1d_init = S1d_init, I01_init = I01_init, I11_init = I11_init, I02_init = I02_init, I03_init = I03_init, I04_init = I04_init, I05_init = I05_init, I22_init = I22_init, I23_init = I23_init, I24_init = I24_init, I25_init = I25_init, I32_init = I32_init, I33_init = I33_init, I34_init = I34_init, I35_init = I35_init, I42_init = I42_init, I43_init = I43_init, I44_init = I44_init, I45_init = I45_init, cumuInf_init = cumuInf_init, theta = theta, OnPrEP_init = OnPrEP_init, M_comm = M_comm, M_noncomm = M_noncomm), use_dde = FALSE) {
  .R6_main_model$new(user = user, use_dde = use_dde)
}
